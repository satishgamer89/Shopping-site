<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>The Aachar Port</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
 --accent:#1faa00;
 --bg:#0f0f0f;
}

*{box-sizing:border-box}

body{
 margin:0;
 font-family:Arial, Helvetica, sans-serif;
 background:var(--bg);
 color:#fff;
}

/* HEADER */
header{
 background:#111;
 padding:12px 16px;
 display:flex;
 justify-content:space-between;
 align-items:center;
}

header b{font-size:18px}

header div{display:flex;gap:12px}

header a{
 color:#fff;
 text-decoration:none;
 font-weight:bold;
 font-size:14px;
 cursor:pointer;
}

/* SECTIONS */
section{padding:16px}

/* PRODUCT GRID */
.products{
 display:grid;
 grid-template-columns:repeat(2,1fr);
 gap:12px;
}

/* CARD */
.card{
 background:#1c1c1c;
 border-radius:18px;
 padding:10px;
 position:relative;
 display:flex;
 flex-direction:column;
 min-height:270px;
}

.card img{
 width:100%;
 height:120px;
 object-fit:contain;
 background:#fff;
 border-radius:14px;
 padding:8px;
 cursor:pointer;
}

.card h3{
 font-size:13px;
 font-weight:600;
 margin:8px 0 4px;
}

/* PRICE */
.price{
 font-size:14px;
 font-weight:700;
 display:flex;
 gap:6px;
}

.old{
 font-size:12px;
 color:#777;
 text-decoration:line-through;
}

/* ADD BUTTON */
.add-btn{
 position:absolute;
 bottom:12px;
 right:12px;
 background:#1faa00;
 color:#fff;
 border:none;
 padding:6px 16px;
 border-radius:10px;
 font-size:13px;
 font-weight:bold;
 cursor:pointer;
}

/* QTY BOX */
.qty-box{
 position:absolute;
 bottom:12px;
 right:12px;
 background:#fff;
 color:#000;
 border-radius:10px;
 display:flex;
 align-items:center;
 overflow:hidden;
 height:32px;
}

.qty-box button{
 width:32px;
 height:32px;
 border:none;
 background:#f2f2f2;
 font-size:18px;
 cursor:pointer;
}

.qty-box span{
 width:32px;
 text-align:center;
 font-weight:bold;
}

/* ADMIN ACTIONS */
.admin-actions{
 margin-top:10px;
 display:flex;
 gap:6px;
}

.admin-actions button{
 background:#333;
 color:#fff;
 border:none;
 padding:6px 8px;
 border-radius:6px;
 font-size:11px;
 cursor:pointer;
}

/* PRODUCT PAGE */
#productPage{
 padding:0;
 animation:slideUp .25s ease;
}

@keyframes slideUp{
 from{transform:translateY(40px);opacity:0}
 to{transform:translateY(0);opacity:1}
}

/* CAROUSEL */
.carousel{
 background:#111;
}

.carousel img{
 width:100%;
 max-height:360px;
 object-fit:contain;
 padding:20px;
}

.dots{
 display:flex;
 justify-content:center;
 gap:6px;
 margin-bottom:10px;
}

.dots span{
 width:8px;
 height:8px;
 border-radius:50%;
 background:#444;
}

.dots .active{background:#1faa00}

/* PRODUCT INFO */
.product-info{
 background:#1c1c1c;
 margin-top:-20px;
 border-radius:20px 20px 0 0;
 padding:16px;
}

.rating{font-size:13px;margin-bottom:6px}
.size{font-size:13px;color:#aaa;margin-bottom:10px}
.product-price{font-size:20px;font-weight:bold}

/* CART BAR */
.cart-bar{
 position:fixed;
 bottom:0;
 left:0;
 right:0;
 background:#111;
 padding:12px 16px;
 display:flex;
 justify-content:space-between;
 align-items:center;
 border-top:1px solid #222;
}

.cart-qty{
 display:flex;
 align-items:center;
 background:#1faa00;
 border-radius:12px;
 overflow:hidden;
}

.cart-qty button{
 background:none;
 border:none;
 color:#fff;
 width:36px;
 height:36px;
 font-size:20px;
 cursor:pointer;
}

.cart-qty span{
 width:32px;
 text-align:center;
 font-weight:bold;
 color:#fff;
}

/* CART */
#cartItems{line-height:1.6}

/* RESPONSIVE */
@media(min-width:768px){
 .products{grid-template-columns:repeat(4,1fr)}
 #productPage,.cart-bar{max-width:480px;margin:auto}
}
</style>
</head>

<body>

<header>
 <b>The Aachar Port</b>
 <div>
  <a onclick="show('home')">Home</a>
  <a onclick="show('cart')">Cart</a>
  <a id="loginLink" onclick="show('login')">Login</a>
  <a id="adminLink" style="display:none" onclick="show('admin')">Admin</a>
  <a id="logoutBtn" style="display:none" onclick="logout()">Logout</a>
 </div>
</header>

<section id="home">
 <h2>Products</h2>
 <div class="products" id="products"></div>
</section>

<section id="cart" style="display:none">
 <h2>Cart</h2>
 <div id="cartItems"></div>
 <h3>Total ₹<span id="total">0</span></h3>
</section>

<section id="login" style="display:none">
 <input id="lEmail" placeholder="Email"><br><br>
 <input id="lPass" type="password" placeholder="Password"><br><br>
 <button onclick="login()">Login</button>
 <hr>
 <input id="sEmail" placeholder="Email"><br><br>
 <input id="sPass" type="password" placeholder="Password"><br><br>
 <button onclick="signup()">Signup</button>
</section>

<section id="admin" style="display:none">
 <input id="pName" placeholder="Name"><br><br>
 <input id="pPrice" type="number" placeholder="Price"><br><br>
 <input id="pDesc" placeholder="Description"><br><br>
 <input id="pIng" placeholder="Ingredients"><br><br>
 <input id="pImages" type="file" multiple><br><br>
 <button onclick="addProduct()">Save Product</button>
</section>

<section id="productPage" style="display:none">
 <button style="margin:12px" onclick="show('home')">←</button>

 <div class="carousel">
  <img id="pdImg">
  <div class="dots" id="dots"></div>
 </div>

 <div class="product-info">
  <div class="rating">⭐⭐⭐⭐☆ (17,321)</div>
  <h2 id="pdName"></h2>
  <div class="size">50 ml</div>
  <div class="product-price">₹<span id="pdPrice"></span></div>
  <p id="pdDesc"></p>
  <p><b>Ingredients:</b> <span id="pdIng"></span></p>
 </div>

 <div class="cart-bar" id="cartBar"></div>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth,onAuthStateChanged,signOut,
 createUserWithEmailAndPassword,signInWithEmailAndPassword }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore,collection,getDocs,addDoc,deleteDoc,doc,updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyA871BbtKAIFdOEIbzCZG7GWAtStNSy8IA",
 authDomain:"the-aachar-port.firebaseapp.com",
 projectId:"the-aachar-port"
};

const CLOUDINARY="dmnsblldh";
const UPLOAD_PRESET="aachar_upload";
const ADMIN="satishbhattrai54@gmail.com";

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let user=null,productsData=[],cart=[],editing=null,currentProductId=null;

/* NAV */
window.show=id=>{
 document.querySelectorAll("section").forEach(s=>s.style.display="none");
 document.getElementById(id).style.display="block";
};

/* AUTH */
window.login=()=>signInWithEmailAndPassword(auth,lEmail.value,lPass.value);
window.signup=()=>createUserWithEmailAndPassword(auth,sEmail.value,sPass.value);
window.logout=async()=>{await signOut(auth);show("home")};

onAuthStateChanged(auth,u=>{
 user=u;
 loginLink.style.display=u?"none":"inline";
 logoutBtn.style.display=u?"inline":"none";
 adminLink.style.display=u&&u.email===ADMIN?"inline":"none";
 loadProducts();
 show("home");
});

/* PRODUCTS */
async function loadProducts(){
 products.innerHTML="";
 const snap=await getDocs(collection(db,"products"));
 productsData=[];
 snap.forEach(d=>{
  const p={id:d.id,...d.data()};
  productsData.push(p);
  products.innerHTML+=`
  <div class="card">
   <img src="${p.images?.[0]||''}" onclick="openProduct('${p.id}')">
   <h3>${p.name}</h3>
   <div class="price">₹${p.price}<span class="old">₹${p.price+30}</span></div>
   <div id="btn-${p.id}">
    <button class="add-btn" onclick="addQty('${p.id}')">ADD</button>
   </div>

   ${
    user && user.email===ADMIN
    ? `
     <div class="admin-actions">
      <button onclick="editProduct('${p.id}')">Edit</button>
      <button onclick="deleteProduct('${p.id}')">Delete</button>
     </div>
    `
    : ""
   }

  </div>`;
 });
}

/* PRODUCT PAGE */
window.openProduct=id=>{
 const p=productsData.find(x=>x.id===id);
 currentProductId=id;
 pdImg.src=p.images?.[0];
 pdName.innerText=p.name;
 pdPrice.innerText=p.price;
 pdDesc.innerText=p.desc||"";
 pdIng.innerText=p.ing||"";
 setupDots(p.images||[]);
 updateProductQtyUI(id);
 show("productPage");
};

function setupDots(imgs){
 dots.innerHTML="";
 imgs.forEach((_,i)=>dots.innerHTML+=`<span class="${i===0?'active':''}"></span>`);
}

/* CART */
window.addToCart=id=>{
 const p=productsData.find(x=>x.id===id);
 const i=cart.find(x=>x.id===id);
 i?i.qty++:cart.push({id,name:p.name,price:p.price,qty:1});
 renderCart();
};

window.addQty=id=>{
 addToCart(id);
 updateQtyUI(id);
 updateProductQtyUI(id);
};

window.removeQty=id=>{
 const i=cart.find(x=>x.id===id);
 if(!i)return;
 i.qty--;
 if(i.qty<=0){
  cart=cart.filter(x=>x.id!==id);
  document.getElementById(`btn-${id}`).innerHTML=
   `<button class="add-btn" onclick="addQty('${id}')">ADD</button>`;
 }
 renderCart();
 updateQtyUI(id);
 updateProductQtyUI(id);
};

function updateQtyUI(id){
 const i=cart.find(x=>x.id===id);
 if(!i)return;
 document.getElementById(`btn-${id}`).innerHTML=`
 <div class="qty-box">
  <button onclick="removeQty('${id}')">−</button>
  <span>${i.qty}</span>
  <button onclick="addQty('${id}')">+</button>
 </div>`;
}

function updateProductQtyUI(id){
 const i=cart.find(x=>x.id===id);
 cartBar.innerHTML=!i?
 `<div>₹${pdPrice.innerText}</div><button onclick="addQty('${id}')">ADD</button>`:
 `<div>₹${pdPrice.innerText}</div>
  <div class="cart-qty">
   <button onclick="removeQty('${id}')">−</button>
   <span>${i.qty}</span>
   <button onclick="addQty('${id}')">+</button>
  </div>`;
}

function renderCart(){
 cartItems.innerHTML="";
 let t=0;
 cart.forEach(c=>{
  t+=c.price*c.qty;
  cartItems.innerHTML+=`${c.name} × ${c.qty} = ₹${c.price*c.qty}<br>`;
 });
 total.innerText=t;
}

/* ADMIN */
window.deleteProduct=async id=>{
 if(confirm("Delete product?")){
  await deleteDoc(doc(db,"products",id));
  loadProducts();
 }
};

window.editProduct=id=>{
 const p=productsData.find(x=>x.id===id);
 pName.value=p.name;
 pPrice.value=p.price;
 pDesc.value=p.desc;
 pIng.value=p.ing;
 editing=id;
 show("admin");
};

window.addProduct=async()=>{
 let imgs=[];
 for(const f of pImages.files){
  const fd=new FormData();
  fd.append("file",f);
  fd.append("upload_preset",UPLOAD_PRESET);
  const r=await fetch(
   `https://api.cloudinary.com/v1_1/${CLOUDINARY}/image/upload`,
   {method:"POST",body:fd}
  );
  imgs.push((await r.json()).secure_url);
 }
 editing
 ? await updateDoc(doc(db,"products",editing),
   {name:pName.value,price:+pPrice.value,desc:pDesc.value,ing:pIng.value,images:imgs})
 : await addDoc(collection(db,"products"),
   {name:pName.value,price:+pPrice.value,desc:pDesc.value,ing:pIng.value,images:imgs});
 editing=null;
 show("home");
 loadProducts();
};
</script>

</body>
</html>
