<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>The Aachar Port</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{--accent:#1faa00;--bg:#0f0f0f}
*{box-sizing:border-box}
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:#fff}

/* HEADER */
header{background:#111;padding:12px 16px;display:flex;justify-content:space-between;align-items:center}
header b{font-size:18px}
header div{display:flex;gap:12px}
header a{color:#fff;text-decoration:none;font-weight:bold;font-size:14px;cursor:pointer}

/* SECTIONS */
section{padding:16px}

/* PRODUCT GRID */
.products{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}

/* CARD */
.card{background:#1c1c1c;border-radius:18px;padding:10px;position:relative;min-height:260px}
.card img{width:100%;height:120px;object-fit:contain;background:#fff;border-radius:14px;padding:8px;cursor:pointer}
.card h3{font-size:13px;margin:8px 0 4px}

/* PRICE */
.price{font-size:14px;font-weight:700;display:flex;gap:6px}
.old{font-size:12px;color:#777;text-decoration:line-through}

/* ADD */
.add-btn{position:absolute;bottom:12px;right:12px;background:#1faa00;color:#fff;border:none;padding:6px 16px;border-radius:10px;font-weight:bold}

/* ADMIN ACTIONS */
.admin-actions{margin-top:10px;display:flex;gap:6px}
.admin-actions button{background:#333;color:#fff;border:none;padding:6px 8px;border-radius:6px;font-size:11px;cursor:pointer}

/* PRODUCT PAGE */
#productPage{padding:0}

/* CART BAR */
.cart-bar{position:fixed;bottom:0;left:0;right:0;background:#111;padding:12px 16px;display:flex;justify-content:space-between;align-items:center}
.cart-qty{display:flex;align-items:center;background:#1faa00;border-radius:12px;overflow:hidden}
.cart-qty button{background:none;border:none;color:#fff;width:36px;height:36px;font-size:20px}
.cart-qty span{width:32px;text-align:center;font-weight:bold}

/* RESPONSIVE */
@media(min-width:768px){
 .products{grid-template-columns:repeat(4,1fr)}
 #productPage,.cart-bar{max-width:480px;margin:auto}
}
</style>
</head>

<body>

<header>
 <b>The Aachar Port</b>
 <div>
  <a onclick="show('home')">Home</a>
  <a onclick="show('cart')">Cart</a>
  <a id="loginLink" onclick="show('login')">Login</a>
  <a id="adminLink" style="display:none" onclick="show('admin')">Admin</a>
  <a id="logoutBtn" style="display:none" onclick="logout()">Logout</a>
 </div>
</header>

<section id="home">
 <h2>Products</h2>
 <div class="products" id="products"></div>
</section>

<section id="login" style="display:none">
 <input id="lEmail" placeholder="Email">
 <input id="lPass" type="password">
 <button onclick="login()">Login</button>
</section>

<section id="admin" style="display:none">
 <input id="pName" placeholder="Name">
 <input id="pPrice" type="number">
 <input id="pDesc" placeholder="Description">
 <input id="pIng" placeholder="Ingredients">
 <input id="pImages" type="file" multiple>
 <button onclick="addProduct()">Save Product</button>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth,onAuthStateChanged,signOut,signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore,collection,getDocs,addDoc,deleteDoc,doc,updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig={apiKey:"AIzaSyA871BbtKAIFdOEIbzCZG7GWAtStNSy8IA",authDomain:"the-aachar-port.firebaseapp.com",projectId:"the-aachar-port"};
const CLOUDINARY="dmnsblldh",UPLOAD_PRESET="aachar_upload",ADMIN="satishbhattrai54@gmail.com";

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let productsData=[],editing=null;

/* NAV */
window.show=id=>{
 document.querySelectorAll("section").forEach(s=>s.style.display="none");
 document.getElementById(id).style.display="block";
};

/* AUTH */
window.login=()=>signInWithEmailAndPassword(auth,lEmail.value,lPass.value);
window.logout=async()=>{await signOut(auth);show("home")};

onAuthStateChanged(auth,u=>{
 loginLink.style.display=u?"none":"inline";
 logoutBtn.style.display=u?"inline":"none";
 adminLink.style.display=u&&u.email===ADMIN?"inline":"none";
 loadProducts();show("home");
});

/* PRODUCTS */
async function loadProducts(){
 products.innerHTML="";
 const snap=await getDocs(collection(db,"products"));
 productsData=[];
 snap.forEach(d=>{
  const p={id:d.id,...d.data()};
  productsData.push(p);
  products.innerHTML+=`
  <div class="card">
   <img src="${p.images?.[0]||''}">
   <h3>${p.name}</h3>
   <div class="price">₹${p.price}<span class="old">₹${p.price+30}</span></div>

   ${auth.currentUser?.email===ADMIN?`
   <div class="admin-actions">
    <button onclick="editProduct('${p.id}')">Edit</button>
    <button onclick="deleteProduct('${p.id}')">Delete</button>
   </div>`:
   `<button class="add-btn">ADD</button>`}
  </div>`;
 });
}

/* ADMIN FUNCTIONS */
window.deleteProduct=async id=>{
 if(confirm("Delete product?")){
  await deleteDoc(doc(db,"products",id));
  loadProducts();
 }
};

window.editProduct=id=>{
 const p=productsData.find(x=>x.id===id);
 editing=id;
 pName.value=p.name;
 pPrice.value=p.price;
 pDesc.value=p.desc||"";
 pIng.value=p.ing||"";
 show("admin");
};

window.addProduct=async()=>{
 let imgs=[];
 if(pImages.files.length){
  for(const f of pImages.files){
   const fd=new FormData();
   fd.append("file",f);
   fd.append("upload_preset",UPLOAD_PRESET);
   const r=await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY}/image/upload`,{method:"POST",body:fd});
   imgs.push((await r.json()).secure_url);
  }
 }

 if(editing){
  const old=productsData.find(p=>p.id===editing);
  await updateDoc(doc(db,"products",editing),{
   name:pName.value,
   price:+pPrice.value,
   desc:pDesc.value,
   ing:pIng.value,
   images:imgs.length?imgs:old.images
  });
 }else{
  await addDoc(collection(db,"products"),{
   name:pName.value,
   price:+pPrice.value,
   desc:pDesc.value,
   ing:pIng.value,
   images:imgs
  });
 }

 editing=null;
 pImages.value="";
 show("home");
 loadProducts();
};
</script>
</body>
</html>
