<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>The Aachar Port</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --primary:#ff6a00;        /* Chilli orange */
  --secondary:#ff9f1c;      /* Saffron */
  --accent:#1faa00;         /* Fresh green */
  --bg:#140b05;             /* Dark spice brown */
  --card:#1f120a;           /* Card background */
  --text:#ffffff;
  --muted:#c8a27a;
}

*{box-sizing:border-box}
body{
 margin:0;
 font-family:Arial, Helvetica, sans-serif;
 background:var(--bg);
 color:var(--text);
}
header{
 background:#111;
 padding:12px 16px;
 display:flex;
 justify-content:space-between;
 align-items:center;
}
header b{font-size:18px}
header div{display:flex;gap:12px}
header a{
 color:#fff;
 text-decoration:none;
 font-weight:bold;
 font-size:14px;
 cursor:pointer;
}
section{padding:16px}
 section{
 animation:iosSlide .35s cubic-bezier(.4,0,.2,1);
}

@keyframes iosSlide{
 from{
  transform:translateX(20px);
  opacity:0;
 }
 to{
  transform:translateX(0);
  opacity:1;
 }
}

.products{
 display:grid;
 grid-template-columns:repeat(2,1fr);
 gap:12px;
}
.card{
 background:var(--card);
 border-radius:18px;
 padding:10px;
 position:relative;
 display:flex;
 flex-direction:column;
 min-height:270px;
}
.card img{
 width:100%;
 height:120px;
 object-fit:contain;
 background:#fff;
 border-radius:14px;
 padding:8px;
 cursor:pointer;
}
.card h3{
 font-size:13px;
 font-weight:600;
 margin:8px 0 4px;
}
.price{
 font-size:14px;
 font-weight:700;
 display:flex;
 gap:6px;
}
.old{
 font-size:12px;
 color:#777;
 text-decoration:line-through;
}
.add-btn{
 position:absolute;
 bottom:12px;
 right:12px;
 background:linear-gradient(135deg,var(--primary),var(--secondary));
 color:#fff;
 border:none;
 padding:6px 16px;
 border-radius:10px;
 font-size:13px;
 font-weight:bold;
 cursor:pointer;
}
.qty-box{
 position:absolute;
 bottom:12px;
 right:12px;
 background:linear-gradient(135deg,var(--primary),var(--secondary));
 color:#fff;
 border-radius:10px;
 display:flex;
 align-items:center;
 overflow:hidden;
 height:32px;
}
.qty-box button{
 width:32px;
 height:32px;
 border:none;
 background:none;
 color:#fff;
 font-size:18px;
 cursor:pointer;
}
.qty-box span{
 width:32px;
 text-align:center;
 font-weight:bold;
  color:#fff;
  
}
.admin-actions{
 margin-top:10px;
 display:flex;
 gap:6px;
}
.admin-actions button{
 background:#333;
 color:#fff;
 border:none;
 padding:6px 8px;
 border-radius:6px;
 font-size:11px;
 cursor:pointer;
}
#productPage{
 padding:0;
 animation:slideUp .25s ease;
}
@keyframes slideUp{
 from{transform:translateY(40px);opacity:0}
 to{transform:translateY(0);opacity:1}
}
.carousel{
 background:#111;
 position:relative;
 overflow:hidden;
}
.carousel img{
 width:100%;
 max-height:360px;
 object-fit:contain;
 padding:20px;
 transition:transform .3s ease;
}
.dots{
 display:flex;
 justify-content:center;
 gap:6px;
 margin-bottom:10px;
}
.dots span{
 width:8px;
 height:8px;
 border-radius:50%;
 background:#444;
 cursor:pointer;
}
.dots .active{background:#1faa00}
.product-info{
 background:#1c1c1c;
 margin-top:-20px;
 border-radius:20px 20px 0 0;
 padding:16px;
}
.rating{font-size:13px;margin-bottom:6px}
.size{font-size:13px;color:#aaa;margin-bottom:10px}
.product-price{font-size:20px;font-weight:bold}
.cart-bar{
 position:fixed;
 bottom:0;
 left:0;
 right:0;
 background:#111;
 padding:12px 16px;
 display:flex;
 justify-content:space-between;
 align-items:center;
 border-top:1px solid #222;
}

.cart-badge{
 position:absolute;
 top:6px;
 right:18px;

 min-width:18px;
 height:18px;
 padding:0 4px;

 background: red;
  color: #fff;
  font-size: 11px;
  font-weight: bold;
  border-radius: 50%;

  display: flex;
  align-items: center;
  justify-content: center;

  line-height: 1;

 animation:bounce .35s ease;
}

@keyframes bounce{
 0%{transform:scale(0.6)}
 50%{transform:scale(1.2)}
 100%{transform:scale(1)}
}
 
.cart-qty{
 display:flex;
 align-items:center;
 background:linear-gradient(135deg,var(--primary),var(--secondary));
 border-radius:12px;
 overflow:hidden;
}
.cart-qty button{
 background:none;
 border:none;
 color:#fff;
 width:36px;
 height:36px;
 font-size:20px;
 cursor:pointer;
}
.cart-qty span{
 width:32px;
 text-align:center;
 font-weight:bold;
 color:#fff;
}
#cartItems{line-height:1.6}
.image-delete{
 position:absolute;
 top:5px; right:5px;
 background:red;
 color:#fff;
 border:none;
 border-radius:50%;
 width:22px;
 height:22px;
 font-size:14px;
 cursor:pointer;
}
@media(min-width:768px){
 .products{grid-template-columns:repeat(4,1fr)}
 #productPage,.cart-bar{max-width:480px;margin:auto}
}

/* ===== Bottom Navigation Bar ===== */
/* iOS Frosted Glass Bottom Navigation */
.bottom-nav{
 position:fixed;
 bottom:12px;
 left:12px;
 right:12px;

 display:flex;
 justify-content:space-around;
 align-items:center;

 padding:10px 8px;
 border-radius:22px;

 background:rgba(30,30,30,0.65);
 backdrop-filter: blur(18px) saturate(180%);
 -webkit-backdrop-filter: blur(18px) saturate(180%);

 box-shadow:
  0 8px 30px rgba(0,0,0,0.4),
  inset 0 1px 0 rgba(255,255,255,0.06);

 z-index:999;
}

/* Bottom nav items */
.nav-item{
 display:flex;
 flex-direction:column;
 align-items:center;
 justify-content:center;
 position:relative;

 gap:4px;
 padding:6px 10px;
 border-radius:14px;

 color:#bbb;
 font-size:11px;
 cursor:pointer;

 transition:all .25s ease;
}

.nav-item .icon{
 font-size:20px;
 line-height:1;
}

/* Active tab */
.nav-item.active{
 color:#fff;
 background:linear-gradient(135deg,var(--primary),var(--secondary));
}

/* Tap feedback (iOS feel) */
.nav-item:active{
 transform:scale(0.94);
}

.bottom-nav.hide{
 transform:translateY(120%);
 opacity:0;
 transition:all .35s cubic-bezier(.4,0,.2,1);
}
#bottomNav {
  transition: transform .3s ease, opacity .3s ease;
}

#bottomNav.hide {
  transform: translateY(120%);
  opacity: 0;
}

 
/* Desktop safe */
@media(min-width:768px){
 .bottom-nav{
  max-width:480px;
  margin:auto;
 }
}
/* ===== Professional Header ===== *//* ===== Premium Spice-Themed Header ===== */
/* ===== Responsive Premium Header ===== */
.main-header{
  position:sticky;
  top:0;
  z-index:1000;

  display:flex;
  justify-content:space-between;
  align-items:center;

  padding:clamp(10px,2vw,18px) clamp(12px,3vw,40px);

  background:linear-gradient(90deg,#1b0f05,#2b1407);
  border-bottom:1px solid rgba(255,140,0,0.2);

  flex-wrap:wrap;
  gap:10px;
}

/* Brand Container */
.brand-container{
  display:flex;
  flex-direction:column;
  cursor:pointer;
}

/* Brand Name Responsive */
.brand-name{
  font-family:'Georgia', serif;
  font-weight:700;

  font-size:clamp(16px,3vw,26px);

  background:linear-gradient(90deg,var(--secondary),var(--primary));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

/* Tagline Responsive */
.brand-tagline{
  font-size:clamp(9px,1.5vw,12px);
  color:var(--muted);
  letter-spacing:1px;
  text-transform:uppercase;
}

/* Header Actions */
.header-actions{
  display:flex;
  align-items:center;
  gap:8px;
  flex-shrink:0;
}

/* Search Input Responsive */
#searchInput{
  padding:6px 10px;
  border-radius:10px;
  border:none;
  outline:none;

  font-size:clamp(12px,1.8vw,14px);

  background:#2a1a12;
  color:#fff;

  width:clamp(100px,20vw,220px);
  transition:0.2s ease;
}

#searchInput:focus{
  width:clamp(140px,30vw,260px);
}

/* Search Button */
.search-btn{
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  border:none;
  color:#fff;

  padding:6px 12px;
  border-radius:10px;

  cursor:pointer;
  font-size:clamp(12px,2vw,14px);

  transition:0.2s ease;
}

.search-btn:active{
  transform:scale(0.92);
}


 /* Spice Particle Container */
.spice-particles{
  position:absolute;
  inset:0;
  overflow:hidden;
  pointer-events:none;
}

/* Individual particles */
.spice-particles::before,
.spice-particles::after{
  content:"";
  position:absolute;
  width:6px;
  height:6px;
  background: radial-gradient(circle,#ff9f1c,#ff3c00);
  border-radius:50%;
  opacity:0.6;
  animation: floatSpice 8s linear infinite;
}

.spice-particles::after{
  left:70%;
  animation-delay:4s;
}

@keyframes floatSpice{
  0%{
    transform:translateY(40px) scale(0.6);
    opacity:0;
  }
  30%{
    opacity:0.7;
  }
  100%{
    transform:translateY(-60px) scale(1);
    opacity:0;
  }
}

 @media(min-width:1024px){
  .main-header{
    max-width:1200px;
    margin:auto;
  }
}
 
.checkout-btn,
.place-order-btn{
  width:100%;
  margin-top:14px;
  padding:12px;

  border:none;
  border-radius:12px;

  font-weight:bold;
  font-size:15px;
  color:#fff;

  background:linear-gradient(135deg,var(--primary),var(--secondary));

  cursor:pointer;
  transition:0.2s ease;
}

.checkout-btn:active,
.place-order-btn:active{
  transform:scale(0.96);
}

#checkoutForm input,
#checkoutForm textarea{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:none;
  background:#2a1a12;
  color:#fff;
  font-size:14px;
}

#cart{
  padding-bottom:120px; /* space for bottom nav */
}
#productPage{
  padding-bottom:120px;
}

#cart,
#productPage{
  padding-bottom:calc(120px + env(safe-area-inset-bottom));
}

</style>
</head>

<body>

<header class="main-header">
  <div class="brand-container" onclick="goHome()">
    <div class="brand-name">The Aachar Port</div>
    <div class="brand-tagline">Authentic Indian Flavours</div>
  </div>

  <div class="header-actions">
    <input type="text" id="searchInput" placeholder="Search pickles..." />
    <button class="search-btn" onclick="searchProducts()">üîç</button>
  </div>
 <div class="spice-particles"></div>
</header>



<section id="home">
 <h2>Products</h2>
 <div class="products" id="products"></div>
</section>

<section id="cart" style="display:none">
 <h2>Cart</h2>

 <div id="cartItems"></div>

 <h3>Total ‚Çπ<span id="total">0</span></h3>

 <button class="checkout-btn" onclick="openCheckout()">
   Proceed to Checkout
 </button>

 <div id="checkoutForm" style="display:none; margin-top:20px;">
   <h3>Delivery Details</h3>

   <input id="cName" placeholder="Full Name"><br><br>
   <input id="cPhone" placeholder="Phone Number"><br><br>
   <textarea id="cAddress" placeholder="Full Address"></textarea><br><br>

   <button class="place-order-btn" onclick="placeOrder()">
     Place Order
   </button>
 </div>
</section>

<section id="login" style="display:none">
 <input id="lEmail" placeholder="Email"><br><br>
 <input id="lPass" type="password" placeholder="Password"><br><br>
 <button onclick="login()">Login</button>
 <hr>
 <input id="sEmail" placeholder="Email"><br><br>
 <input id="sPass" type="password" placeholder="Password"><br><br>
 <button onclick="signup()">Signup</button>
</section>

<section id="admin" style="display:none">
 <input id="pName" placeholder="Name"><br><br>
 <input id="pPrice" type="number" placeholder="Price"><br><br>
 <input id="pDesc" placeholder="Description"><br><br>
 <input id="pIng" placeholder="Ingredients"><br><br>
 <input id="pImages" type="file" multiple><br><br>
 <div id="currentImages"></div>
 <button onclick="addProduct()">Save Product</button>
</section>

<section id="orders" style="display:none">
  <h2>Orders</h2>
  <div id="ordersList"></div>
</section>

<section id="productPage" style="display:none">
 <button style="margin:12px" onclick="show('home')">‚Üê</button>
 <div class="carousel" id="carousel">
  <img id="pdImg">
  <div class="dots" id="dots"></div>
 </div>
 <div class="product-info">
  <div class="rating">‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ (17,321)</div>
  <h2 id="pdName"></h2>
  <div class="size">50 ml</div>
  <div class="product-price">‚Çπ<span id="pdPrice"></span></div>
  <p id="pdDesc"></p>
  <p><b>Ingredients:</b> <span id="pdIng"></span></p>
 </div>
 <div class="cart-bar" id="cartBar"></div>
</section>

<!-- Bottom Navigation (Main Navigation System) -->
<div class="bottom-nav" id="bottomNav">
  <div class="nav-item active" onclick="show('home');setActive(this)">
    <span class="icon">üè†</span>
    <small>Home</small>
  </div>

   <div class="nav-item" data-nav="cart" onclick="show('cart');setActive(this)">
    <span class="icon">üõí</span>
    <small>Cart</small>
  </div>

  <div class="nav-item" id="loginNav" onclick="show('login');setActive(this)">
    <span class="icon">üîê</span>
    <small>Login</small>
  </div>

  <div class="nav-item" id="adminNav" style="display:none"
       onclick="show('admin');setActive(this)">
    <span class="icon">‚öôÔ∏è</span>
    <small>Admin</small>
  </div>

  <div class="nav-item" id="ordersNav" style="display:none"
     onclick="show('orders');loadOrders();setActive(this)">
  <span class="icon">üì¶</span>
  <small>Orders</small>
</div>

  <div class="nav-item" id="logoutNav" style="display:none"
       onclick="logout();setActive(this)">
    <span class="icon">üö™</span>
    <small>Logout</small>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth,onAuthStateChanged,signOut,
 createUserWithEmailAndPassword,signInWithEmailAndPassword }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore,collection,getDocs,addDoc,deleteDoc,doc,updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyA871BbtKAIFdOEIbzCZG7GWAtStNSy8IA",
 authDomain:"the-aachar-port.firebaseapp.com",
 projectId:"the-aachar-port"
};

const CLOUDINARY="dmnsblldh";
const UPLOAD_PRESET="aachar_upload";
const ADMIN="satishbhattrai54@gmail.com";

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);
 

let user=null,productsData=[],cart=[],editing=null,currentImages=[],imgIndex=0,autoSlide,touchXStart=0;

// ===== ANDROID DOM BIND FIX =====
const products = document.getElementById("products");
const cartItems = document.getElementById("cartItems");
const cartBar = document.getElementById("cartBar");
const total = document.getElementById("total");

const pdImg = document.getElementById("pdImg");
const pdName = document.getElementById("pdName");
const pdPrice = document.getElementById("pdPrice");
const pdDesc = document.getElementById("pdDesc");
const pdIng = document.getElementById("pdIng");
const dots = document.getElementById("dots");

const lEmail = document.getElementById("lEmail");
const lPass = document.getElementById("lPass");
const sEmail = document.getElementById("sEmail");
const sPass = document.getElementById("sPass");

const pName = document.getElementById("pName");
const pPrice = document.getElementById("pPrice");
const pDesc = document.getElementById("pDesc");
const pIng = document.getElementById("pIng");
const pImages = document.getElementById("pImages");

 
window.show = id => {

  // hide all sections
  document.querySelectorAll("section").forEach(
    s => s.style.display = "none"
  );

  // show selected section
  const page = document.getElementById(id);
  if (page) page.style.display = "block";

  // navbar control
  const nav = document.getElementById("bottomNav");

  if (id === "productPage") {
    nav.style.display = "none";
  } else {
    nav.style.display = "flex";
  }

  // reset scroll
  window.scrollTo(0,0);
};




window.login=()=>signInWithEmailAndPassword(auth,lEmail.value,lPass.value);
window.signup=()=>createUserWithEmailAndPassword(auth,sEmail.value,sPass.value);
window.logout=async()=>{await signOut(auth);show("home")};

onAuthStateChanged(auth,u=>{
 user=u;
 document.getElementById("loginNav").style.display = u ? "none" : "flex";
 document.getElementById("logoutNav").style.display = u ? "flex" : "none";
 document.getElementById("adminNav").style.display =
  u && u.email===ADMIN ? "flex" : "none";
 document.getElementById("ordersNav").style.display =
  u && u.email===ADMIN ? "flex" : "none";
 loadProducts();
 show("home");
});

async function loadProducts(){
 products.innerHTML="";
 const snap=await getDocs(collection(db,"products"));
 productsData=[];
 snap.forEach(d=>{
  const p={id:d.id,...d.data()};
  productsData.push(p);
  products.innerHTML+=`
  <div class="card">
   <img src="${p.images?.[0]||''}" onclick="openProduct('${p.id}')">
   <h3>${p.name}</h3>
   <div class="price">‚Çπ${p.price}<span class="old">‚Çπ${p.price+30}</span></div>
   <div id="btn-${p.id}">
    <button class="add-btn" onclick="addQty('${p.id}')">ADD</button>
   </div>
   ${user&&user.email===ADMIN?`
   <div class="admin-actions">
    <button onclick="editProduct('${p.id}')">Edit</button>
    <button onclick="deleteProduct('${p.id}')">Delete</button>
   </div>`:""}
  </div>`;
 });
}

async function loadOrders(){
  const ordersList = document.getElementById("ordersList");
  ordersList.innerHTML = "";

  const snap = await getDocs(collection(db,"orders"));

  snap.forEach(d=>{
    const o = {id:d.id, ...d.data()};

    ordersList.innerHTML += `
      <div style="background:#1f120a;padding:12px;margin-bottom:10px;border-radius:12px;">
        <b>${o.customer.name}</b><br>
        üìû ${o.customer.phone}<br>
        ‚Çπ${o.total}<br>
        Status:
        <select onchange="updateStatus('${o.id}',this.value)">
          <option ${o.status==="Pending"?"selected":""}>Pending</option>
          <option ${o.status==="Shipped"?"selected":""}>Shipped</option>
          <option ${o.status==="Delivered"?"selected":""}>Delivered</option>
        </select>
      </div>
    `;
  });
}
  
window.updateStatus = async (id,status)=>{
  await updateDoc(doc(db,"orders",id), { status });
  loadOrders();
};

  
window.searchProducts = () => {
  const keyword = document.getElementById("searchInput").value.toLowerCase();
  const cards = document.querySelectorAll(".card");

  cards.forEach(card => {
    const name = card.querySelector("h3").innerText.toLowerCase();
    if (name.includes(keyword)) {
      card.style.display = "flex";
    } else {
      card.style.display = "none";
    }
  });
};

 
window.openProduct=id=>{
 document.getElementById("bottomNav").style.display = "none";
 const p=productsData.find(x=>x.id===id);
 currentImages=p.images||[];
 imgIndex=0;
 pdImg.src=currentImages[0]||"";
 pdName.innerText=p.name;
 pdPrice.innerText=p.price;
 pdDesc.innerText=p.desc||"";
 pdIng.innerText=p.ing||"";
 renderDots();
 updateProductQtyUI(id);
 startAutoSlide();
 show("productPage");
};

function renderDots(){
 dots.innerHTML="";
 currentImages.forEach((_,i)=>{
  const s=document.createElement("span");
  if(i===imgIndex)s.classList.add("active");
  s.onclick=()=>{imgIndex=i;pdImg.src=currentImages[i];renderDots();};
  dots.appendChild(s);
 });
}

function startAutoSlide(){
 clearInterval(autoSlide);
 autoSlide=setInterval(()=>{
  if(currentImages.length>1){
   imgIndex=(imgIndex+1)%currentImages.length;
   pdImg.src=currentImages[imgIndex];
   renderDots();
  }
 },3000);
}

function renderCart(){
 cartItems.innerHTML="";
 let t=0,qty=0;

 cart.forEach(c=>{
  t+=c.price*c.qty;
  qty+=c.qty;
  cartItems.innerHTML+=`${c.name} √ó ${c.qty} = ‚Çπ${c.price*c.qty}<br>`;
 });
 total.innerText=t;

 // badge update
 const cartNav=document.querySelector('[data-nav="cart"]');
 if(cartNav){
  let badge=cartNav.querySelector(".cart-badge");
  if(qty>0){
   if(!badge){
    badge=document.createElement("div");
    badge.className="cart-badge";
    cartNav.appendChild(badge);
   }
   badge.innerText=qty;
  }else if(badge){
   badge.remove();
  }
 }
}

 
// Swipe support
pdImg.addEventListener("touchstart",e=>{touchXStart=e.touches[0].clientX;});
pdImg.addEventListener("touchend",e=>{
 let diff=touchXStart-e.changedTouches[0].clientX;
 if(Math.abs(diff)>40){
  imgIndex+=diff>0?1:-1;
  if(imgIndex<0) imgIndex=currentImages.length-1;
  if(imgIndex>=currentImages.length) imgIndex=0;
  pdImg.src=currentImages[imgIndex];
  renderDots();
 }
});

// CART
window.addToCart=id=>{
 const p=productsData.find(x=>x.id===id);
 const i=cart.find(x=>x.id===id);
 i?i.qty++:cart.push({id,name:p.name,price:p.price,qty:1});
 renderCart();
};
window.addQty=id=>{
 addToCart(id);
 updateQtyUI(id);
 updateProductQtyUI(id);
};
window.removeQty=id=>{
 const i=cart.find(x=>x.id===id);
 if(!i)return;
 i.qty--;
 if(i.qty<=0){
  cart=cart.filter(x=>x.id!==id);
  document.getElementById(`btn-${id}`).innerHTML=
   `<button class="add-btn" onclick="addQty('${id}')">ADD</button>`;
 }
 renderCart();
 updateQtyUI(id);
 updateProductQtyUI(id);
};
function updateQtyUI(id){
 const i=cart.find(x=>x.id===id);
 if(!i)return;
 document.getElementById(`btn-${id}`).innerHTML=`
 <div class="qty-box">
  <button onclick="removeQty('${id}')">‚àí</button>
  <span>${i.qty}</span>
  <button onclick="addQty('${id}')">+</button>
 </div>`;
}
function updateProductQtyUI(id){
 const i=cart.find(x=>x.id===id);
 cartBar.innerHTML=!i?
   `<div>‚Çπ${pdPrice.innerText}</div>
 <button class="add-btn" style="position:static"
  onclick="addQty('${id}')">ADD</button>`:

 `<div>‚Çπ${pdPrice.innerText}</div>
  <div class="cart-qty">
   <button onclick="removeQty('${id}')">‚àí</button>
   <span>${i.qty}</span>
   <button onclick="addQty('${id}')">+</button>
  </div>`;
}

// ADMIN
window.deleteProduct=async id=>{
 if(confirm("Delete product?")){
  await deleteDoc(doc(db,"products",id));
  loadProducts();
 }
};
window.editProduct=id=>{
 const p=productsData.find(x=>x.id===id);
 pName.value=p.name;
 pPrice.value=p.price;
 pDesc.value=p.desc;
 pIng.value=p.ing;
 currentImages=p.images||[];
 editing=id;
 show("admin");
 renderCurrentImages();
};
function renderCurrentImages(){
 currentImagesDiv=document.getElementById("currentImages");
 currentImagesDiv.innerHTML="";
 currentImages.forEach((url,i)=>{
  const btn=document.createElement("button");
  btn.innerText="√ó";
  btn.className="image-delete";
  btn.onclick=()=>{currentImages.splice(i,1);renderCurrentImages();};
  const img=document.createElement("img");
  img.src=url;
  img.style.width="60px";
  img.style.margin="2px";
  img.style.borderRadius="8px";
  img.style.position="relative";
  const wrapper=document.createElement("div");
  wrapper.style.display="inline-block";
  wrapper.style.position="relative";
  wrapper.appendChild(img);
  wrapper.appendChild(btn);
  currentImagesDiv.appendChild(wrapper);
 });
}
window.addProduct=async()=>{
 let imgs=[...currentImages];
 if(pImages.files.length){
  for(const f of pImages.files){
   const fd=new FormData();
   fd.append("file",f);
   fd.append("upload_preset",UPLOAD_PRESET);
   const r=await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY}/image/upload`,
    {method:"POST",body:fd});
   imgs.push((await r.json()).secure_url);
  }
 }
 if(editing){
  await updateDoc(doc(db,"products",editing),
   {name:pName.value,price:+pPrice.value,desc:pDesc.value,ing:pIng.value,
    images:imgs});
 }else{
  await addDoc(collection(db,"products"),
   {name:pName.value,price:+pPrice.value,desc:pDesc.value,ing:pIng.value,images:imgs});
 }
 editing=null;
 currentImages=[];
 pImages.value=null;
 show("home");
 loadProducts();
};

window.openCheckout = () => {
  if(cart.length === 0){
    alert("Your cart is empty");
    return;
  }

  document.getElementById("checkoutForm").style.display = "block";
};

window.placeOrder = async () => {

  const name = document.getElementById("cName").value;
  const phone = document.getElementById("cPhone").value;
  const address = document.getElementById("cAddress").value;

  if(!name || !phone || !address){
    alert("Please fill all details");
    return;
  }

  const orderData = {
    customer:{
      name,
      phone,
      address,
      email: user?.email || "guest"
    },
    items: cart,
    total: cart.reduce((t,i)=>t+i.price*i.qty,0),
    status: "Pending", 
    createdAt: new Date()
  };

  try{
    await addDoc(collection(db,"orders"), orderData);
    // WhatsApp message
try{
  await addDoc(collection(db,"orders"), orderData);

  const message = `
üõí New Order - The Aachar Port

Name: ${name}
Phone: ${phone}
Address: ${address}

Items:
${cart.map(i=>`${i.name} x${i.qty} = ‚Çπ${i.price*i.qty}`).join("\n")}

Total: ‚Çπ${orderData.total}
`;

  const whatsappNumber = "918383897693"; // your number

  window.location.href =
    `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;

}catch(err){
  console.error("Order error:", err);
  alert("Order failed: " + err.message);
}


    alert("Order Placed Successfully! üéâ");

    cart = [];
    renderCart();

    document.getElementById("checkoutForm").style.display = "none";
    document.getElementById("cName").value = "";
    document.getElementById("cPhone").value = "";
    document.getElementById("cAddress").value = "";

    show("home");

  }catch(err){
    alert("Order failed. Try again.");
  }
  console.log("Saving order:", orderData);
};

  
window.setActive = el => {
 document.querySelectorAll('.nav-item')
  .forEach(i=>i.classList.remove('active'));
 el.classList.add('active');
};

let lastScrollY = window.scrollY;

window.addEventListener("scroll", () => {
  const nav = document.getElementById("bottomNav");
  if (!nav) return;

  // do not hide navbar on product page
  if (document.getElementById("productPage").style.display === "block") {
    nav.style.display = "none";
    return;
  }

  if (window.scrollY > lastScrollY && window.scrollY > 80) {
    nav.classList.add("hide");
  } else {
    nav.classList.remove("hide");
  }

  lastScrollY = window.scrollY;
});

window.goHome = () => {
  show("home");

  // activate Home tab in bottom nav
  document.querySelectorAll('.nav-item')
    .forEach(i => i.classList.remove('active'));

  const homeTab = document.querySelector('.nav-item');
  if (homeTab) homeTab.classList.add('active');
};

 
</script>

</body>
</html>
