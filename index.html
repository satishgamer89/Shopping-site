<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>The Aachar Port</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{--accent:#1faa00;--bg:#0f0f0f}
*{box-sizing:border-box}

body{
 margin:0;
 font-family:Arial, Helvetica, sans-serif;
 background:var(--bg);
 color:#fff;
}

/* HEADER */
header{
 background:#111;
 padding:12px 16px;
 display:flex;
 justify-content:space-between;
 align-items:center;
}
header b{font-size:18px}
header div{display:flex;gap:12px}
header a{color:#fff;text-decoration:none;font-weight:bold;font-size:14px;cursor:pointer}

/* SECTIONS */
section{padding:16px}

/* PRODUCT GRID */
.products{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}

/* CARD */
.card{
 background:#1c1c1c;
 border-radius:18px;
 padding:10px;
 position:relative;
 min-height:260px;
}
.card img{
 width:100%;height:120px;object-fit:contain;
 background:#fff;border-radius:14px;padding:8px;cursor:pointer
}
.card h3{font-size:13px;margin:8px 0 4px}

/* PRICE */
.price{font-size:14px;font-weight:700;display:flex;gap:6px}
.old{font-size:12px;color:#777;text-decoration:line-through}

/* ADD */
.add-btn{
 position:absolute;bottom:12px;right:12px;
 background:#1faa00;color:#fff;border:none;
 padding:6px 16px;border-radius:10px;font-weight:bold
}

/* PRODUCT PAGE */
#productPage{padding:0}

/* CAROUSEL */
.carousel{background:#111;overflow:hidden;position:relative}
.carousel-track{display:flex;transition:.3s ease}
.carousel img{width:100%;flex-shrink:0;max-height:360px;object-fit:contain;padding:20px}

/* DOTS */
.dots{display:flex;justify-content:center;gap:6px;margin:6px 0}
.dots span{width:8px;height:8px;border-radius:50%;background:#444}
.dots .active{background:#1faa00}

/* THUMBNAILS */
.thumbs{
 display:flex;gap:8px;overflow-x:auto;
 padding:10px;background:#111
}
.thumbs img{
 height:54px;width:54px;
 object-fit:contain;background:#fff;
 border-radius:10px;padding:6px;
 border:2px solid transparent;cursor:pointer
}
.thumbs img.active{border-color:#1faa00}

/* INFO */
.product-info{
 background:#1c1c1c;
 margin-top:-20px;border-radius:20px 20px 0 0;
 padding:16px
}
.product-price{font-size:20px;font-weight:bold}

/* CART BAR */
.cart-bar{
 position:fixed;bottom:0;left:0;right:0;
 background:#111;padding:12px 16px;
 display:flex;justify-content:space-between;align-items:center
}
.cart-qty{
 display:flex;align-items:center;
 background:#1faa00;border-radius:12px;overflow:hidden
}
.cart-qty button{
 background:none;border:none;color:#fff;
 width:36px;height:36px;font-size:20px
}
.cart-qty span{width:32px;text-align:center;font-weight:bold}

/* RESPONSIVE */
@media(min-width:768px){
 .products{grid-template-columns:repeat(4,1fr)}
 #productPage,.cart-bar{max-width:480px;margin:auto}
}
</style>
</head>

<body>

<header>
 <b>The Aachar Port</b>
 <div>
  <a onclick="show('home')">Home</a>
  <a onclick="show('cart')">Cart</a>
  <a id="loginLink" onclick="show('login')">Login</a>
  <a id="adminLink" style="display:none" onclick="show('admin')">Admin</a>
  <a id="logoutBtn" style="display:none" onclick="logout()">Logout</a>
 </div>
</header>

<section id="home">
 <h2>Products</h2>
 <div class="products" id="products"></div>
</section>

<section id="cart" style="display:none">
 <h2>Cart</h2>
 <div id="cartItems"></div>
 <h3>Total ₹<span id="total">0</span></h3>
</section>

<section id="login" style="display:none">
 <input id="lEmail" placeholder="Email">
 <input id="lPass" type="password">
 <button onclick="login()">Login</button>
</section>

<section id="admin" style="display:none">
 <input id="pName" placeholder="Name">
 <input id="pPrice" type="number">
 <input id="pDesc" placeholder="Description">
 <input id="pIng" placeholder="Ingredients">
 <input id="pImages" type="file" multiple>
 <button onclick="addProduct()">Save Product</button>
</section>

<section id="productPage" style="display:none">
 <button style="margin:12px" onclick="show('home')">←</button>

 <div class="carousel" id="carousel">
  <div class="carousel-track" id="carouselTrack"></div>
 </div>
 <div class="dots" id="dots"></div>
 <div class="thumbs" id="thumbs"></div>

 <div class="product-info">
  <h2 id="pdName"></h2>
  <div class="product-price">₹<span id="pdPrice"></span></div>
  <p id="pdDesc"></p>
  <p><b>Ingredients:</b> <span id="pdIng"></span></p>
 </div>

 <div class="cart-bar" id="cartBar"></div>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth,onAuthStateChanged,signOut,
 signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore,collection,getDocs,addDoc,deleteDoc,doc,updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig={apiKey:"AIzaSyA871BbtKAIFdOEIbzCZG7GWAtStNSy8IA",authDomain:"the-aachar-port.firebaseapp.com",projectId:"the-aachar-port"};
const CLOUDINARY="dmnsblldh",UPLOAD_PRESET="aachar_upload",ADMIN="satishbhattrai54@gmail.com";

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let productsData=[],cart=[],slideIndex=0,autoSlide,touchX=0;

/* NAV */
window.show=id=>{
 document.querySelectorAll("section").forEach(s=>s.style.display="none");
 document.getElementById(id).style.display="block";
};

/* AUTH */
window.login=()=>signInWithEmailAndPassword(auth,lEmail.value,lPass.value);
window.logout=async()=>{await signOut(auth);show("home")};

onAuthStateChanged(auth,u=>{
 loginLink.style.display=u?"none":"inline";
 logoutBtn.style.display=u?"inline":"none";
 adminLink.style.display=u&&u.email===ADMIN?"inline":"none";
 loadProducts();show("home");
});

/* PRODUCTS */
async function loadProducts(){
 products.innerHTML="";
 const snap=await getDocs(collection(db,"products"));
 productsData=[];
 snap.forEach(d=>{
  const p={id:d.id,...d.data()};
  productsData.push(p);
  products.innerHTML+=`
  <div class="card">
   <img src="${p.images?.[0]||''}" onclick="openProduct('${p.id}')">
   <h3>${p.name}</h3>
   <div class="price">₹${p.price}<span class="old">₹${p.price+30}</span></div>
   <button class="add-btn" onclick="addQty('${p.id}')">ADD</button>
  </div>`;
 });
}

/* PRODUCT PAGE */
window.openProduct=id=>{
 const p=productsData.find(x=>x.id===id);
 pdName.innerText=p.name;
 pdPrice.innerText=p.price;
 pdDesc.innerText=p.desc||"";
 pdIng.innerText=p.ing||"";
 buildCarousel(p.images||[]);
 show("productPage");
};

function buildCarousel(imgs){
 carouselTrack.innerHTML="";dots.innerHTML="";thumbs.innerHTML="";
 slideIndex=0;clearInterval(autoSlide);

 imgs.forEach((img,i)=>{
  carouselTrack.innerHTML+=`<img src="${img}">`;
  dots.innerHTML+=`<span class="${i==0?'active':''}"></span>`;
  thumbs.innerHTML+=`<img src="${img}" onclick="goSlide(${i})" class="${i==0?'active':''}">`;
 });

 autoSlide=setInterval(()=>nextSlide(),3000);
 updateSlide();
}

function updateSlide(){
 const w=carousel.offsetWidth;
 carouselTrack.style.transform=`translateX(-${slideIndex*w}px)`;
 document.querySelectorAll(".dots span").forEach((d,i)=>d.classList.toggle("active",i===slideIndex));
 document.querySelectorAll(".thumbs img").forEach((t,i)=>t.classList.toggle("active",i===slideIndex));
}

function nextSlide(){
 slideIndex=(slideIndex+1)%carouselTrack.children.length;
 updateSlide();
}

window.goSlide=i=>{slideIndex=i;updateSlide()};

/* SWIPE */
carousel.addEventListener("touchstart",e=>touchX=e.touches[0].clientX);
carousel.addEventListener("touchend",e=>{
 let diff=touchX-e.changedTouches[0].clientX;
 if(Math.abs(diff)>40){
  slideIndex+=diff>0?1:-1;
  if(slideIndex<0)slideIndex=0;
  if(slideIndex>=carouselTrack.children.length)slideIndex=carouselTrack.children.length-1;
  updateSlide();
 }
});

/* CART */
window.addQty=id=>{
 const p=productsData.find(x=>x.id===id);
 const i=cart.find(x=>x.id===id);
 i?i.qty++:cart.push({id,price:p.price,qty:1});
 updateBar(id);
};

window.removeQty=id=>{
 const i=cart.find(x=>x.id===id);
 if(!i)return;
 i.qty--;if(i.qty<=0)cart=cart.filter(x=>x.id!==id);
 updateBar(id);
};

function updateBar(id){
 const i=cart.find(x=>x.id===id);
 cartBar.innerHTML=!i?
 `<div>₹${pdPrice.innerText}</div><button onclick="addQty('${id}')">ADD</button>`:
 `<div>₹${pdPrice.innerText}</div>
  <div class="cart-qty">
   <button onclick="removeQty('${id}')">−</button>
   <span>${i.qty}</span>
   <button onclick="addQty('${id}')">+</button>
  </div>`;
}
</script>
</body>
</html>
